<div class="page-container">
  <app-banner-carousel 
    [items]="carouselItems"
    [preferredItemWidth]="252"
    [maxSmallItemWidth]="56">
  </app-banner-carousel>

  <div class="produtos-container">
    <!-- Loading state -->
    <div class="loading-container" *ngIf="isLoading">
      <mat-spinner></mat-spinner>
      <p>Carregando produtos...</p>
    </div>

    <!-- Products loaded -->
    <ng-container *ngIf="!isLoading && produtosPorCategoria?.length">
      
      <!-- Loop para cada categoria -->
      <div class="categoria-section" *ngFor="let categoriaGroup of produtosPorCategoria">
        
        <!-- Header da categoria com ícone -->
        <div class="categoria-header">
          <div class="categoria-title-wrapper">
            <mat-icon class="categoria-icon">{{ getCategoriaIcon(categoriaGroup.categoria) }}</mat-icon>
            <h2 class="categoria-title">{{ categoriaGroup.categoria }}</h2>
            <span class="produto-count">{{ categoriaGroup.produtos.length }} {{ categoriaGroup.produtos.length === 1 ? 'produto' : 'produtos' }}</span>
          </div>
        </div>
        
        <!-- Carrossel de produtos da categoria -->
        <div class="horizontal-carousel produtos-carousel">
          <div class="carousel-container produtos-carousel-container">
            <mat-card 
              class="produto-card carousel-item" 
              *ngFor="let produto of categoriaGroup.produtos"
              (click)="navigateToDetalhes(produto.id)"
            >
              <!-- Imagem do produto -->
              <div class="produto-imagem-wrapper">
                <div class="produto-imagem">
                  <img 
                    [src]="produto.imagem" 
                    [alt]="produto.nome"
                    (error)="onImageError($event)"
                  />
                </div>
                <!-- Badge de categoria na imagem -->
                <div class="produto-badge">
                  <mat-icon class="badge-icon">{{ getCategoriaIcon(produto.categoria) }}</mat-icon>
                  <span>{{ produto.categoria }}</span>
                </div>
              </div>

              <!-- Conteúdo do card -->
              <mat-card-content class="produto-content">
                <h3 class="produto-nome" mat-card-title>{{ produto.nome }}</h3>
              </mat-card-content>

              <!-- Botão de ação -->
              <mat-card-actions class="produto-actions" (click)="$event.stopPropagation()">
                <button 
                  *ngIf="!isProdutoDoUsuario(produto)" 
                  mat-button 
                  class="button-trocar" 
                  (click)="navigateToTroca(produto.id)">
                  <mat-icon>swap_horiz</mat-icon>
                  <span>Oferecer troca</span>
                </button>
              </mat-card-actions>
            </mat-card>
          </div>
        </div>
        
      </div>
      
    </ng-container>

    <!-- No products message -->
    <div class="no-products" *ngIf="!isLoading && !produtosPorCategoria?.length">
      <p>Nenhum produto encontrado.</p>
    </div>
  </div>
</div>

<!-- Modal de Detalhes do Produto -->
<app-detalhes-produto></app-detalhes-produto>

<!-- Modal de Oferecer Troca -->
<app-troca></app-troca>
