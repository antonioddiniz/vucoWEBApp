<div class="chats-container">
  <h2 class="page-title">Mensagens</h2>

  <div *ngIf="carregando" class="loading">
    <p>Carregando chats...</p>
  </div>

  <div *ngIf="!carregando && chats.length === 0" class="sem-chats">
    <p>ğŸ’¬ VocÃª ainda nÃ£o tem conversas</p>
    <p class="hint">As conversas aparecerÃ£o aqui quando vocÃª aceitar uma transaÃ§Ã£o</p>
  </div>

  <div class="chats-lista" *ngIf="!carregando && chats.length > 0">
    <div 
      *ngFor="let chat of chats" 
      class="chat-card" 
      (click)="abrirConversa(chat)"
      [class.com-nao-lidas]="chat.mensagensNaoLidas && chat.mensagensNaoLidas > 0">
      
      <div class="chat-avatar">
        <span class="avatar-icon">ğŸ‘¤</span>
      </div>

      <div class="chat-info">
        <div class="chat-header">
          <h3 class="chat-nome">Troca #{{ chat.transacaoId }}</h3>
          <span class="chat-data" *ngIf="chat.ultimaMensagem">
            {{ formatarData(chat.ultimaMensagem.dataEnvio) }}
          </span>
        </div>

        <!-- InformaÃ§Ãµes dos produtos da troca -->
        <div class="troca-produtos" *ngIf="chat.transacao">
          <div class="produtos-grupo">
            <span class="produtos-label">Seus produtos:</span>
            <div class="produtos-miniaturas">
              <div class="produto-miniatura" *ngFor="let produto of getProdutosUsuario(chat)" [title]="produto.nome">
                <img [src]="produto.imagem" [alt]="produto.nome" (error)="onImageError($event)">
              </div>
              <span *ngIf="getProdutosUsuario(chat).length === 0" class="sem-produtos">Nenhum produto</span>
            </div>
          </div>
          <div class="produtos-grupo">
            <span class="produtos-label">Produtos recebidos:</span>
            <div class="produtos-miniaturas">
              <div class="produto-miniatura" *ngFor="let produto of getProdutosOutroUsuario(chat)" [title]="produto.nome">
                <img [src]="produto.imagem" [alt]="produto.nome" (error)="onImageError($event)">
              </div>
              <span *ngIf="getProdutosOutroUsuario(chat).length === 0" class="sem-produtos">Nenhum produto</span>
            </div>
          </div>
        </div>

        <div class="chat-preview">
          <p class="ultima-mensagem" *ngIf="chat.ultimaMensagem">
            {{ chat.ultimaMensagem.texto }}
          </p>
          <p class="ultima-mensagem sem-mensagens" *ngIf="!chat.ultimaMensagem">
            Nenhuma mensagem ainda
          </p>
          
          <span class="badge-nao-lidas" *ngIf="chat.mensagensNaoLidas && chat.mensagensNaoLidas > 0">
            {{ chat.mensagensNaoLidas }}
          </span>
        </div>
      </div>
    </div>
  </div>
</div>
