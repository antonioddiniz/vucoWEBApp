<!-- Modal Overlay -->
<div class="modal-overlay" *ngIf="isModalOpen" (click)="closeModal()"
     [style.opacity]="modalOpacity"
     [style.transition]="isSwipingModal ? 'none' : 'opacity 0.3s ease'"></div>

<!-- Modal Container -->
<div class="modal-container" 
     [class.modal-open]="isModalOpen"
     (touchstart)="onTouchStart($event)"
     (touchmove)="onTouchMove($event)"
     (touchend)="onTouchEnd($event)"
     [style.transform]="modalTransform"
     [style.transition]="isSwipingModal ? 'none' : 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)'"
     [style.will-change]="isSwipingModal ? 'transform' : 'auto'">
  <div class="produto-detalhes-container" *ngIf="produto">
  <mat-card class="produto-detalhes-card">
    <!-- Header com botão voltar -->
    <div class="header-actions">
      <button mat-icon-button (click)="goBack()" class="back-button">
        <mat-icon>arrow_back</mat-icon>
      </button>
    </div>

    <!-- Galeria de imagens do produto -->
    <div class="produto-imagem-container">
      <div class="image-gallery" *ngIf="getImagensCarrossel().length > 0">
        <!-- Imagem principal (grande) -->
        <div class="main-image-wrapper">
          <img 
            [src]="getImagensCarrossel()[currentImageIndex]" 
            [alt]="produto.nome"
            (error)="onImageError($event)"
            class="main-image"
          />
        </div>
        
        <!-- Miniaturas -->
        <div class="thumbnails-container" *ngIf="getImagensCarrossel().length > 1">
          <div class="thumbnails-scroll">
            <div 
              *ngFor="let img of getImagensCarrossel(); let i = index"
              class="thumbnail-wrapper"
              [class.active]="i === currentImageIndex"
              (click)="goToImage(i)">
              <img 
                [src]="img" 
                [alt]="produto.nome + ' - ' + (i + 1)"
                (error)="onImageError($event)"
                class="thumbnail-image"
              />
            </div>
          </div>
        </div>
      </div>
    </div>

    <mat-card-content class="produto-content">
      <!-- Título e categoria -->
      <div class="produto-header">
        <h1 class="produto-titulo">{{ produto.nome }}</h1>
        <div class="categoria-badge">
          <mat-icon class="category-icon">category</mat-icon>
          <span>{{ produto.categoria }}</span>
        </div>
      </div>

      <!-- Status badge -->
      <div class="status-container">
        <span [class]="'status-badge status-' + (produto.status === 1 ? 'disponivel' : 'indisponivel')">
          <mat-icon class="status-icon">{{ produto.status === 1 ? 'check_circle' : 'cancel' }}</mat-icon>
          <span>{{ produto.status === 1 ? 'Disponível' : 'Indisponível' }}</span>
        </span>
      </div>

      <!-- Descrição -->
      <div class="descricao-section">
        <h3 class="section-title">Descrição</h3>
        <p class="descricao-texto">{{ produto.descricao }}</p>
      </div>

      <!-- Informações adicionais -->
      <div class="info-section">
        <div class="info-item">
          <mat-icon class="info-icon">calendar_today</mat-icon>
          <div class="info-content">
            <span class="info-label">Data de Criação</span>
            <span class="info-value">{{ produto.dataDeCriacao | date:'dd/MM/yyyy' }}</span>
          </div>
        </div>
        <div class="info-item">
          <mat-icon class="info-icon">person</mat-icon>
          <div class="info-content">
            <span class="info-label">Dono do Produto</span>
            <span class="info-value">{{ nomeUsuario }}</span>
          </div>
        </div>
      </div>
    </mat-card-content>

    <!-- Botão para oferecer troca -->
    <mat-card-actions class="produto-actions" *ngIf="!isProdutoDoUsuario(produto)">
      <button mat-raised-button class="troca-button" (click)="oferecerTroca()">
        <mat-icon>swap_horiz</mat-icon>
        <span>Oferecer Troca</span>
      </button>
      </mat-card-actions>
  </mat-card>
  </div>
</div>

<!-- Exibir mensagem de carregamento enquanto o produto está sendo carregado
<div class="loading-container" *ngIf="!produto">
  <mat-spinner></mat-spinner>
  <p>Carregando detalhes do produto...1</p>
</div> -->