<!-- Modal Overlay -->
<div class="modal-overlay" *ngIf="isModalOpen" (click)="closeModal()"></div>

<!-- Modal Container -->
<div class="modal-container" 
     [class.modal-open]="isModalOpen"
     (touchstart)="onTouchStart($event)"
     (touchend)="onTouchEnd($event)">
  <div class="troca-container">
    <!-- Header com botão voltar -->
  <div class="header-actions">
    <button mat-icon-button (click)="goBack()" class="back-button">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h2 class="troca-title">Oferecer Troca</h2>
  </div>

  <!-- Produtos do outro usuário (para selecionar) -->
  <div class="produto-section">
    <h3 class="section-title">
      Produtos do outro usuário
      <span class="count-badge" *ngIf="produtosOutroUsuarioSelecionados.length > 0">
        {{ produtosOutroUsuarioSelecionados.length }} selecionado(s)
      </span>
    </h3>
    <p class="section-description">Selecione um ou mais produtos que você deseja receber:</p>
    
    <div class="itens-grid">
      <div 
        class="item-card-checkbox" 
        *ngFor="let item of produtosOutroUsuario"
        [class.selected]="isProdutoSelecionado(item.id, produtosOutroUsuarioSelecionados)"
        (click)="toggleProdutoOutroUsuario(item.id)">
        <div class="checkbox-wrapper">
          <mat-checkbox 
            [checked]="isProdutoSelecionado(item.id, produtosOutroUsuarioSelecionados)"
            (click)="$event.stopPropagation()"
            (change)="toggleProdutoOutroUsuario(item.id)">
          </mat-checkbox>
        </div>
        <img [src]="item.imagem" [alt]="item.nome" class="item-image">
        <div class="item-info">
          <span class="item-name">{{ item.nome }}</span>
        </div>
      </div>
    </div>
    <p *ngIf="produtosOutroUsuario.length === 0" class="empty-message">Carregando produtos...</p>
  </div>

  <!-- Meus produtos (para oferecer) -->
  <div class="produto-section">
    <h3 class="section-title">
      Seus produtos
      <span class="count-badge" *ngIf="meusItensSelecionados.length > 0">
        {{ meusItensSelecionados.length }} selecionado(s)
      </span>
    </h3>
    <p class="section-description">Selecione um ou mais produtos que você quer oferecer:</p>
    
    <div class="itens-grid">
      <div 
        class="item-card-checkbox" 
        *ngFor="let item of meusItens"
        [class.selected]="isProdutoSelecionado(item.id, meusItensSelecionados)"
        (click)="toggleMeuItem(item.id)">
        <div class="checkbox-wrapper">
          <mat-checkbox 
            [checked]="isProdutoSelecionado(item.id, meusItensSelecionados)"
            (click)="$event.stopPropagation()"
            (change)="toggleMeuItem(item.id)">
          </mat-checkbox>
        </div>
        <img [src]="item.imagem" [alt]="item.nome" class="item-image">
        <div class="item-info">
          <span class="item-name">{{ item.nome }}</span>
        </div>
      </div>
    </div>
    <p *ngIf="meusItens.length === 0" class="empty-message">Você não possui produtos cadastrados.</p>
  </div>

  <!-- Resumo e botão -->
  <div class="summary-section" *ngIf="meusItensSelecionados.length > 0 || produtosOutroUsuarioSelecionados.length > 0">
    <div class="summary-box">
      <p class="summary-text">
        <strong>Resumo:</strong> Você está oferecendo <strong>{{ meusItensSelecionados.length }}</strong> produto(s)
        em troca de <strong>{{ produtosOutroUsuarioSelecionados.length }}</strong> produto(s)
      </p>
    </div>
  </div>

  <!-- Botão para submeter a proposta -->
  <div class="actions-section">
    <button 
      class="submit-btn" 
      (click)="submeterProposta()"
      [disabled]="meusItensSelecionados.length === 0 || produtosOutroUsuarioSelecionados.length === 0">
      Enviar Proposta de Troca
    </button>
  </div>
  </div>
</div>
